---
---
---

Titre: **Projet R Data Viz**

Nom: Nouran GHALIOUNJI

Pacours: M1 BIDADI

# Introduction

Nous avons une bas√© de donn√©es sous forme de fichier Excel qui inclut les variables suivantes:

-   Identifier (RIC) : identifiant RIC de l‚Äôentreprise
-   Company Name : Nom de l‚Äôentreprise
-   ISIN : code ISIN de l‚Äôentreprise
-   COUNTRY OF DOMICIL: code du pays de l‚Äôentreprise

**Variables environnementales :**

-   Environment Pillar Score: mesure de la performance environnementale de l‚Äôentreprise. Il s‚Äôagit de la composante E de la norme ESG

-   Carbon Intensity per Energy Produced : Mesure relative aux √©missions de CO2

    **Variables √©conomiques et commerciales**

<!-- -->

-   EMPLOYEES (EMP) : nombre d‚Äôemploy√©s par entreprise comme mesure de la taille de l‚Äôentreprise

-   OPERATING PROFIT MARGIN (MARGIN) : profit op√©rationnel de l‚Äôentreprise

-   NET SALES OR REVENUES (SALES) : les revenus commerciaux nets

    **Variables financi√®res**

<!-- -->

-   Market Cap (MCAP): capitalisation boursi√®re de l‚Äôentreprise

-   RETURN ON INVESTED CAPITAL (RCAP): le rendement du capital investi

-   Plusieurs Variables PRIX : o 1-day Price PCT Change o 5-day Price PCT Change o 4-week Price PCT Change o 13-week Price PCT Change o 26-week Price PCT Change o YTD Price PCT Change o 52-week Price PCT Change o Price 52 Week High

    **Variables de gouvernance**

<!-- -->

-   CSR Sustainability Committee (CSR) : la mise en place d‚Äôun comit√© de soutenabilit√© CSR ou pas (Y si oui et N sinon)
-   Value - Board Structure/Independent Board Members (Board): le pourcentage des members ind√©pendants dans le board

Le but de notre travail est de saisir l'impact des variables √©conomiques, financi√®res, et de gouvernance des entreprises list√©es dans notre base de donn√©es sur notre variable environnementale: le score environnemental.

Tout au long de notre travail on va tenter d'analyser nos donn√©es, et de prendre des d√©cisions dont le but ultime est de construire le mod√®le le moins biais√© possible.

On commence tout d'abord pour importer dans notre environnement les libraries n√©cessaires pour le travail

```{r}
library('readxl')
library('dplyr')
library('dplyr')
library('ggplot2')
#Elle nous permettera de lire les r√©sum√©s summary de mani√®re plus lisible 
library('pander') 
#On d√©sactive les altertes
options(warn=-1)
```

Partie 1:

On importe tout d'abord le jeu de donn√©es qui est sous forme de fichier Excel qu'on stockera dans le dataframe 'eurostoxx'

```{r}
eurostoxx<-read_excel("C:/Users/Visiteur/Downloads/Projet R/variables_EuroStoxx600.xlsx")
View(eurostoxx)
```

```{r}
summary(eurostoxx)
```

# **PARTIE 1: R√©ponse question 1**

Lorsqu'on execute la fonction str pour voir la structure de la colonne carbonne intensity per energy producted, on remarque que les 'NA' qui sont les valeurs manquantes sont stock√©s tel que des cha√Ænes de caract√®re. Dans cette √©tude on doit s‚Äôen tenir √† la premi√®re variable qui est Environement Pillar Score (EPS) car la variable Carbon Intensity per Energy produced est manquante pour la plupart des observations

```{r}
str(eurostoxx$`Carbon Intensity per Energy Produced`)
```

On v√©rifie une seconde fois avec la fonction is NA et on voit bien ici que R ne reconna√Æt pas les chaines de caract√®res 'NA' tel que des valeurs manquantes.

```{r}
is.na(eurostoxx$'Carbon Intensity per Energy Produced')
```

On utilise la fonction na.if pour remplacer les cha√Ænes de caract√®re 'NA' en tant que NA pour que R puisse les traiter comme tel.

```{r}
eurostoxx$'Carbon Intensity per Energy Produced'[eurostoxx$'Carbon Intensity per Energy Produced' == 'NA'] <- NA
```

On v√©rfie de nouveau avec la fonction is.na si l'opp√©ration a fonctionn√© et cette fois-ci on obtient bien la boolean TRUE lorsqu'on lance la ligne de code.

```{r}
is.na(eurostoxx$'Carbon Intensity per Energy Produced')
```

On effectue la m√™me op√©ration sur tout le data frame pour ne pas avoir a rencontr√© le m√™me probl√®me de nouveau en utilisant la fonction replace.

```{r}
eurostoxx <-  replace(eurostoxx, eurostoxx=='NA', NA)
```

# PARTIE 2: Analyse en composante principale

L‚Äôanalyse en composante principale (ACP) est une technique de r√©duction de dimensionalit√© qui permet de visualiser des donn√©es et d‚Äôidentifier les relations entre les diff√©rentes variables quantitatives. D‚Äôautres m√©thodes de r√©duction de dimensions existent aussi pour les donn√©es qui sont de nature qualitatives tel que l‚Äôanalyse des correspondances. Dans notre cas ici, nous avons 8 variables financi√®res et on souhaite pouvoir observer la relation entre ces variables. Typiquement, lorsqu‚Äôon a deux ou trois variables, il est assez facile de les repr√©senter visuellement et de saisir la ou les relations qui existent entre elles. Mais dans le cas o√π nous avons 8 variables comme ici, il est difficile de les visualiser et de saisir la complexit√© de toutes les relations qui peuvent exister entre les variables. Pour cela, nous avons recours √† l‚ÄôACP afin d‚Äôidentifier les relations qui existent entre les diff√©rentes variables financi√®res sur le plan multivari√© et ponctuellement d‚Äôanalyser et les ressemblances et les oppositions entre les diff√©rentes observations sur notre jeu de donn√©es.

De plus, il est utile de rappeler que le but ultime de notre analyse est de saisir l‚Äôimpact des diff√©rentes variables financi√®res, √©conomiques, et de gouvernance sur la performance environnementale des entreprises en effectuant une r√©gression lin√©aire. L‚Äôajout de nombreuses variables dans une r√©gression peut finir par devenir p√©nalisant dans notre analyse dans le sens ou il introduirait beaucoup trop de degr√©s de libert√© dans la r√©gression et potentiellement d‚Äôautres biais. Synth√©tiser les nombreuses variables financi√®res que nous obtiendrons gr√¢ce √† l‚ÄôACP nous permettra de tenir compte de l‚Äôaspect financier en une seule variable que l‚Äôon nommera ‚ÄòFi‚Äô et qu‚Äôon pourra directement introduire dans la r√©gression.

Pour effectuer l‚Äôanalyse en composante principale sur les variables financi√®res, tout d‚Äôabord on va reconstruire une data frame √† partir des variables financi√®res d‚Äôeurostoxx.

```{r}
print(colnames(eurostoxx))
```

```{r}
eurostoxx_acp <- eurostoxx[ ,c("Company Name" , "1-day Price PCT Change\r\n(Œ£=Avg)" , "5-day Price PCT Change\r\n(Œ£=Avg)", "4-week Price PCT Change\r\n(Œ£=Avg)", "13-week Price PCT Change\r\n(Œ£=Avg)","26-week Price PCT Change\r\n(Œ£=Avg)","YTD Price PCT Change\r\n(Œ£=Avg)","52-week Price PCT Change\r\n(Œ£=Avg)", "Price 52 Week High\r\n(Œ£=Avg)")]
```

Comme les noms des colonnes sont tr√®s compliqu√©s, nous allons renommer chacune des colonnes s√©lectionn√©es afin d'avoir des noms qui soient plus simples.

```{r}
colnames(eurostoxx_acp) <- c("Company Name","1-day Price PCT Change", "5-day Price PCT Change
", "4-week Price PCT Change", "13-week Price PCT Change", "26-week Price PCT Change", "YTD Price PCT Change", "52-week Price PCT Change", "Price 52 Week High")
```

On commence en suite par charger les packages dont on a besoin pour effectuer l'ACP

```{r}
library('FactoMineR')
library('corrplot')
library('factoextra')
```

On remarque que pour la colonne '26 Week price change' nous avons une valeur manquante. Pour ex√©cuter notre ACP correctement, on ne doit pas avoir de valeur manquante et on va donc la remplacer par la valeur de la m√©diane sur cette colonne.

```{r}
pander(summary(eurostoxx_acp))
eurostoxx_acp$'26-week Price PCT Change'[is.na(eurostoxx_acp$'26-week Price PCT Change')] <- median(eurostoxx_acp$'26-week Price PCT Change', na.rm = TRUE)
eurostoxx_acp$'52-week Price PCT Change'[is.na(eurostoxx_acp$'52-week Price PCT Change')]<- median(eurostoxx_acp$'52-week Price PCT Change', na.rm = TRUE)
pander(summary(eurostoxx_acp))
```

Avant d'effectuer l'ACP, on fait une matrice des corr√©lations pour tenter de voir les relations qui existent entre les diff√©rentes variables. La couleur bleu fonc√©e signifie qu'il existe une forte corr√©lation positive entre deux variables et la couleur rouge vive fait r√©f√©rence √† une corr√©lation n√©gative forte entre deux variables. Ici il ne semble y avoir de corr√©lation n√©gative forte, mais par contre certaines variables sont corr√©l√©es fortement de fa√ßon positive entre elles comme '52 week price change', '13 week price percerntage change', '26 week price percentage change', et 'YTD price percentage change'. Cela semble indiqu√© qu'il existe une forte corr√©lation entre les changements de prix sur le long terme et c'est quelque chose que l'on pourra investiguer davantage apr√®s avoir effectu√© notre ACP.

```{r}

matrice_correlation <- cor(eurostoxx_acp %>% select_if(is.numeric), use = "complete.obs")


corrplot(matrice_correlation, method="color", type='upper', order= "hclust", 
         tl.col= "black", tl.srt= 45,
        addCoef.col = 'black', 
        cl.pos= "n", 
        cl.cex= 1.2, 
        addCoefasPercent = TRUE, 
        number.cex= 0.8)
```

Nous effectuons notre ACP et obtenons ainsi les r√©sultats suivants:

-   Le premier tableau renvoie la variation expliqu√©e par chaque composante principale. Dans notre cas nous avons 8 composantes puisque nous avons 8 variables entre lesquelles nous cherchons √† expliquer le lien.

-   Le graphique des individus: Ce graphique renvoie la repr√©sentation des individus en fonction du premier et et du deuxi√®me axe obtenus par l'analyse en composante principale. Plus les individus sont proches l'un de l'autre dans l'espace, plus ils ont de similitude. Dans notre cas, on remarque que l'entreprise 'Swedish Match AB' (individu 449 sur le graphique) se distingue fortement des autres individus.

-   Le graphique des variables: Ce graphique renvoie la repr√©sentation des variables en fonction de la premi√®re et de la deuxi√®me dimension. Plus des variables sont proches dans l'espace, plus sont corr√©l√©es entre elles.

### Interpr√©tation des r√©sultats obtenus

Les variations expliqu√©es par l'analyse: La premi√®re dimension explique plus de 44% de la variation dans les variables, la deuxi√®me dimension n'en explique que 18% et puis la 3eme en explique 12% . Ainsi, les 3 premi√®res dimensions de notre ACP expliquent d√©j√† 75% de la variation qui existe entre nos variables financi√®res.

-   La r√©partition des individus: Ici les individus que nous avons repr√©sent√© la liste des diff√©rentes entreprises. Avant de regarder le graphique des variables on constate d‚Äôembl√©e que la grande majorit√© des individus semblent √™tre r√©partis dans le centre du graphique, ce qui sugg√®re que la performance financi√®re des entreprises est assez homog√®ne dans notre √©chantillon. Cependant, on observe quelques valeurs aberrantes tel que l'individu 449 qui est l'entreprise su√©doise 'Swedish Match AB' qui est une multinationale su√©doise sp√©cialis√©e dans les produits tabagiques. On remarque √©galement l'individu 332 qui est l'entreprise d'automobile allemande Rheinmetall AG, et l'individu 32 qui est l'entreprise K&S AG qui est une entreprise chimique allemande. Ces entreprises sont assez se d√©marquent du reste des entreprises ce qui sugg√®rent qu'elles enregistrent des r√©sultats financiers qui diff√®rent fortement des autres entreprises dans notre jeu de donn√©es.

-   La r√©partition des variables: Le deuxi√®me graphique tr√®s important qui est produit par l'analyse en composante principale est celui des variables. Il nous permet de voir quelles variables se ressemblent le plus et lesquelles sont √©loign√©es l'une de l'autre. Sur l'axe des abscisse on trouve la premi√®re dimension et sur l'axe des ordonn√©es la deuxi√®me dimension. Avant d'interpr√©ter des variables sur une dimension, il faut v√©rifier qu'elles soient bien repr√©sent√©es sur celle-ci et pour cela on n'interpr√©tera uniquement les variables qui ont un cos2 qui soit sup√©rieur √† 0.5.

    -   La premi√®re dimension: Sur la premi√®re dimension, nous avons les variables: 13 week price change, 36 week price change, YTD price change, 52 week price change. En effet, ces variables sont toutes bien repr√©sent√©es sur la 1√®re dimension avec un cos2 sup√©rieur √† 0,5. Toutes ces variables vont dans le m√™me sens (√† droite) ce qui sugg√®re qu'il y a une tr√®s forte corr√©lation entre elles. Si on regarde toutes ces variables on voit qu'elles repr√©sentent toutes une variation dans le prix sur le long terme et donc on en fera l'hypoth√®se que la premi√®re composante repr√©sente la variabilit√© financi√®re sur le long terme.

    -   La deuxi√®me dimension: Toutes les variables qu'on a cit√© sur les premi√®re dimension ne sont pas bien repr√©sent√©es sur la deuxi√®me dimension. Sur la deuxi√®me dimension, on a uniquement la variable 1 day price change, 5 day price change et 4 week price change, cependant uniquement la variable 5 day price change est bien repr√©sent√©e avec un cos2 de plus de 0.7 et la variable 4 week price change a un cos2 de 0.467 pas tr√®s loin de la threshold de 0.5 donc on peut en tenir en compte mais avec beaucoup d'attention dans notre interpr√©tation. La deuxi√®me dimension ne capte que 18% de la variabilit√© dans les variabilit√©s est c'est pour cela qu'elle est bien plus difficile √† interpr√©ter mais on peut faire l'hypoth√®se qu'elle repr√©sente les variations de prix sur le court terme.

    -   La troisi√®me dimension: Jusque-l√†, dans notre premier graphique des variables qui incluait uniquement la 1√®re et la deuxi√®me composante, on ne voyait pas la variable "price 52 week high", et c'est logique puisque celle-ci n'est repr√©sent√©e sur aucune des autres composantes, mais par contre explique √† elle seule plus de 96% de la variabilit√© sur le troisi√®me axe. On fait donc un graphique ou l'on repr√©sente le 3eme axe et on voit que c'est la seule variable qui est repr√©sent√©e sur cet axe. C'est assez logique puisque toutes les autres variables repr√©sentent des √©volutions en pourcentage, alors que la variable price 52 week high n'est pas exprim√©e en pourcentage et n'a donc rien en commun avec les autres variables, ce qui explique pourquoi elle est repr√©sent√©e seule dans notre analyse.

```{r}
rownames(eurostoxx_acp) <- eurostoxx_acp$`Company Name`
acp_eurostoxx <- PCA((eurostoxx_acp %>% select_if(is.numeric)), scale.unit= T, ncp=length(1:9), graph= T)
print(summary(acp_eurostoxx))

fviz_pca_var(acp_eurostoxx, axes = c(1, 3), 
             labelsize = 3) +
  labs(title = "ACP - Variables sur le 1er et 3√®me axe")
```

Ce graphique repr√©sente le pourcentage de variance des variables expliqu√© par les diff√©rentes composantes dans notre analyse. Comme √©voqu√© pr√©c√©demment la premi√®re composante explique 44.8% de la variance, la deuxi√®me 18.1%, et la troisi√®me 12.6%.

Pour choisir le nombre d'axes avec lesquels travailler en ACP il existe de nombreuses m√©thodes dont les plus connues:

-   La r√®gle du coude: Celle-ci consiste √† ne tenir compte que des dimensions avant qu'il y ait un point d'inflexion dans la variance expliqu√©e. En l'occurrence ici, la r√®gle du coude nous encouragerait √† ne tenir compte que de la premi√®re composante.

-   La r√®gle des 75%: Cette r√®gle nous dit qu'il faut conserver toutes les dimensions jusqu'√† avoir 75% de variance cumul√©e. Dans notre cas cela voudrait dire qu'on conserverait les 3 premiers axes dans notre analyse.

```{r}
fviz_eig(acp_eurostoxx, addlabels=T)
```

Extraction de la variable financi√®re Fi √† partir de la premi√®re composante

```{r}
Fi <- acp_eurostoxx$ind$coord[, "Dim.1"]
```

# PARTIE 3: Statistiques descriptives et r√©gression lin√©aire (Question 3)

On va tout d'abord contruire un nouveau dataframe √† partir des variables dont on a besoin pour faire notre analyse qui ont √©t√© √©voqu√©es dans l'√©nonc√©.

```{r}
names(eurostoxx) <- gsub("\n", " ", names(eurostoxx))

# Now subset with the modified column names
new_eurostoxx <- eurostoxx[, c("COUNTRY OF DOMICIL", 
                        "Environment Pillar Score", 
                        "EMPLOYEES", 
                        "OPERATING PROFIT MARGIN", 
                        "NET SALES OR REVENUES", 
                        "Market Cap\r (Œ£=Avg)", 
                        "RETURN ON INVESTED CAPITAL", 
                        "CSR Sustainability Committee", 
                        "Value - Board Structure/Independent Board Members")]
```

```{r}
new_eurostoxx$Fi <- Fi 
```

Tout d'abord, on va voir les diff√©rentes classes dans notre base de donn√©es. On constate que les variables auxquelles on va s'int√©resser pour notre √©tudes sont de diff√©rents types:

**-Environment Pillar Score (EPS): charact√®re**

COUNTRY OF DOMICIL: chaine de caract√®res

-EMPLOYEES (EMP): chaine de caract√®res

-OPERATING PROFIT MARGIN (MARGIN): chaine de caract√®res -\> √† modifier

-NET SALES OR REVENUES (SALES): caract√®re -\> √† modifier

-Market Cap (MCAP): num√©rique

-RETURN ON INVESTED CAPITAL (RCAP): charact√®re -\> √† modifier

-CSR Sustainability Committee (CSR)-\> boolean

-Value: Board Structure/Independent Board Members (Board) ‚Äì\> caract√®re

Pour cette √©tude, on va tenter d'expliquer la variable Environment Pillar Score (EPS) √† travers toutes les variables explicatives

```{r}
lapply(new_eurostoxx, class)
```

Avant de proc√©der √† une analyse plus d√©taill√©e sur nos variables, on doit d'abord convertir les variables charact√®res en tant que variables num√©rique afin de pouvoir les visualiser et effectuer les analyses n√©cessaires dessus.

```{r}
variables <- c("Environment Pillar Score", "EMPLOYEES", "OPERATING PROFIT MARGIN", "NET SALES OR REVENUES","RETURN ON INVESTED CAPITAL","Value - Board Structure/Independent Board Members") 

new_eurostoxx[variables] <- lapply(new_eurostoxx[variables], as.numeric)
```

```{r}
lapply(new_eurostoxx, class)
```

Une autre transformation qui doit √©galement √™tre effectu√©e est sur notre variable cat√©gorique 'CSR Sustainability Committee" qui porte pour valeur Y et N correspondant au fait si oui ou non une entreprise poss√®de une comit√© CSR dans sa structure. Pour pouvoir traiter cette variable, on doit la transfomer en facteur.

```{r}
#On v√©rifie si la colonne CSR sustainability est en facteur
is.factor(new_eurostoxx$'CSR Sustainability Committee')
#On tranforme le type de la colonne
new_eurostoxx$'CSR Sustainability Committee' <- factor(
  new_eurostoxx$'CSR Sustainability Committee', 
  levels = c("Y", "N"), 
  label= c("Oui", "Non"))
#On v√©rifie si la colonne prend d√©sormais le type facteur
is.factor(new_eurostoxx$`CSR Sustainability Committee`)
```

On fait la m√™me chose sur la variable COUNTRY OF DOMICIL qui est une variable cat√©gorique qui correspond au pays d'origine de chaque entreprise.

```{r}
unique(new_eurostoxx$`COUNTRY OF DOMICIL`)
```

```{r}
is.factor(new_eurostoxx$`COUNTRY OF DOMICIL`)

new_eurostoxx$`COUNTRY OF DOMICIL` <- factor(
  new_eurostoxx$`COUNTRY OF DOMICIL`,
  levels = c("BD", "BG", "BM", "DK", "ES", "FN", "FR", "IR", 
             "IT", "LX", "MA", "NL", "NW", "OE", "PT", 
             "SD", "SW", "UK", "FA", "IM", "PO"),
  labels = c("Allemagne", "Bulgarie", "Bermudes", "Danemark", 
             "Espagne", "Finlande", "France", "Irlande", 
             "Italie", "Luxembourg", "Malte",
             "Pays-Bas", "Norv√®ge", "Autriche", "Portugal", 
             "Su√®de", "Suisse", "Royaume-Uni", "√éles F√©ro√©", 
             "√éle de Man", "Pologne")
)

is.factor(new_eurostoxx$`COUNTRY OF DOMICIL`)
#Afficher tous les levels 
levels(new_eurostoxx$`COUNTRY OF DOMICIL`)
```

Puisque le nom des pays est donn√© par code, on fait une recherche sur ce que chaque code de pays signifie et on lui donne sa valeur r√©elle en tant que label en utilisant la commande factor().

## A. Traiter les valeurs manquantes

Lorsqu'on a des donn√©es manquantes, il peut √™tre tentant de simplement les ignorer et de travailler et contruire notre mod√®le avec des donn√©es manquantes. Sachant que chaque obervation nous permet de gagner en pr√©cision, construire un mod√®le avec des donn√©es manquantes peut nous faire perdre en pr√©cision. Pour savoir que faire avec nos donn√©es manquantes, il est important de d'en conna√Ætre la raison. C'est pour cela que dans cette partie, on va essayer d'analyser la structure de nos donn√©es manquantes pour savoir de quelle fa√ßon on peut y rem√©dier.

```{r}
#On renomme la colonne return on invested capital pour avoir plus d'espace 
names(new_eurostoxx)[names(new_eurostoxx) == "RETURN ON INVESTED CAPITAL"] <- "ROIC"
names(new_eurostoxx)[names(new_eurostoxx) == "Market Cap\r (Œ£=Avg)"] <- "Market Cap"
#On utilise la fonction pander ici car elle nous permet d'avoir un summary plus compr√©hensible et simple √† lire. 
pander(summary(new_eurostoxx))
```

Dans notre jeu de donn√©es on a identifi√© dans la premi√®re partie de notre analyse qu'on avait beaucoup de donn√©es manquantes. Etant de donn√©es que dans notre jeu de donn√©es ne contient pas un grand nombre d'observations, on essaye d'analyser ces valeurs manquantes pour voir si il y a une structure particuli√®re qui affecte les valeurs manquantes et on essaye de les remplacer afin de ne pas avoir un grande perte d'information pour estimer notre mod√®le de fa√ßon plus pr√©cise.

```{r}
#les packages n√©cessaire pour faire l'analyse des valeurs manquantes 
library(tidyverse)
library(naniar)
library(gtExtras)
library(mice)
```

Ce graphique nous permet de visualiser les valeurs manquantes et on peut constater visuellement que sur notre jeu de donn√©es, on a des valeurs manquantes pour toutes nos variables hormis la variable 'Market Cap'. On constate √©galement que pour certaines valeurs il semble y avoir exactement le m√™me nombre de valeurs manquantes, ce qui nous pousse √† faire une analyse plus d√©taill√©e.

```{r}
gg_miss_var(new_eurostoxx)
```

Ce graphique nous permet de voir les valeurs qui sont manquantes simultan√©ment. On remarque en effet que sur notre jeu de donn√©es, on a plusieurs variables qui sont manquantes sur les m√™mes observations. En g√©n√©ral lorsqu'on fait face √† des donn√©es manquantes on a plusieurs choix sur la mani√®re dont elles peuvent √™tre traiter. Les choix les plus communs sont:

-   La supression des valeurs manquantes

-   Le remplacement par une stastique comme la m√©diane ou la moyenne

-   L'estimation √† travers un mod√®le machine learning comme KNN (k-nearest neighbor) qui consiste √† calculer une moyenne de l'observation manquante avec ses voisins les plus proche

Dans notre cas, on a des donn√©es qui sont manquantes sur les m√™mes observations simultan√©ment et donc les remplacer par une valeur 'artificielle' pourrait nuire √† la pr√©cision du mod√®le qu'on cherche √† construire et √† estimer. Pour cela, on fait le choix de supprimer les observations l√† ou il y 'a des observations manquantes sur plus de 3 colonnes, et on remplacera par la m√©diane une observation qui est uniquement manquante sur la colonne 'operating profit margin'.

```{r}
gg_miss_upset(new_eurostoxx) 

```

Etant donn√© que la variable qu'on cherche √† expliquer est le score environnemental, on remarque que sur plusieurs observations, on a des valeurs manquantes sur cette colonne qui sont aussi manquantes sur d'autres colonnes avec lesquelles on cherche √† expliquer la variation dans le score environnemental. Pour y rem√©dier, on supprime ces observations la car les remplacer par la m√©diane ou la moyenne sur plusieurs colonnes et donc les remplacer par des valeurs artificielles pourrait induire √† un biais dans le mod√®le qu'on cherche √† construire plus tard.

```{r}
#On reconstruit donc notre data frame sans inclure les observations sur lesquelles on a des valeurs manquantes sur 5 colonnes au m√™me temps
new_eurostoxx <- new_eurostoxx[!(
  is.na(new_eurostoxx$`OPERATING PROFIT MARGIN`) &
  is.na(new_eurostoxx$ROIC) &
  is.na(new_eurostoxx$`Environment Pillar Score`) &
  is.na(new_eurostoxx$`CSR Sustainability Committee`) &
  is.na(new_eurostoxx$`Value - Board Structure/Independent Board Members`)
), ]

```

Ici on reconstruit notre data frame en excluant les observations sur lesquelles on a des valeurs manquantes sur plus de 4 colonnes au m√™me temps pour les m√™mes observations.

```{r}
new_eurostoxx <- new_eurostoxx[!(
  is.na(new_eurostoxx$ROIC) &
  is.na(new_eurostoxx$`Environment Pillar Score`) &
  is.na(new_eurostoxx$`CSR Sustainability Committee`) &
  is.na(new_eurostoxx$`Value - Board Structure/Independent Board Members`)
), ]

```

Ici on reconstruit notre data frame en excluant les observations sur lesquelles on a des valeurs manquantes sur plus de 3 colonnes au m√™me temps pour les m√™mes observations.

```{r}
new_eurostoxx <- new_eurostoxx[!(
  is.na(new_eurostoxx$`Environment Pillar Score`) &
  is.na(new_eurostoxx$`CSR Sustainability Committee`) &
  is.na(new_eurostoxx$`Value - Board Structure/Independent Board Members`)
), ]
```

Gr√¢ce aux transformation qu'on a faites, il ne nous reste plus que des valeurs manquantes sur la colonne 'Operating profit'. Etant donn√© qu'il ne s'agit que d'une seule valeur, on va la remplacer par sa m√©diane de sorte √† ne plus avoir de valeurs manquantes dans notre jeu de donn√©es.

En utilisant la commande structure pour voir notre jeu de donn√©es, on voit bien qu'apr√®s les op√©rations qu'on a faite qu'il ne nous reste plus qu'une seule valeur manquante sur la colonne 'Operating Profit'.

```{r}
pander(summary (new_eurostoxx))
```

On remplace la valeur manquante sur la colonne operating profit margin par la m√©diane et on voit bien qu'apr√®s traitement de notre jeu de donn√©es pour les valeurs manquantes, il ne nous reste plus de valeurs 'NA' dans nos colonnes. L'op√©ration a donc bien fonctionn√© et le nombre d'observations dans notre jeu de donn√©es passe de 600 √† 554, ce qui nous reste tout de m√™me tr√®s suffisant pour estimer un mod√®le non biais√©. Dans le cas ou on aurait eu un bien plus grand nombre de NA, on aurait consid√©rer d'autres approches de remplacement robustes en utilisant des m√©thodes de remplacement par mod√®le de machine learning pour tenter de pr√©server au maximum le nombre d'observations. Etant donn√© que 554 observations sont tr√®s suffisantes pour constuire un mod√®le de regression, on a donc fait le choix de supprimer des observations pour les lignes qui posaient probl√®me et de remplacer par la m√©diane.

```{r}
mediane <- median (new_eurostoxx$`OPERATING PROFIT MARGIN`, na.rm = TRUE)
new_eurostoxx$`OPERATING PROFIT MARGIN`[is.na(new_eurostoxx$`OPERATING PROFIT MARGIN`)] <- mediane 
pander(summary(new_eurostoxx))
```

## B. D√©tecter et traiter les valeurs aberrantes (question 3)

Maintenant que nous n'avons plus de valeurs manquantes sur notre jeu de donn√©es, on passe √† la d√©tection et au traitement des valeurs aberrantes qui peuvent exister sur notre jeu de donn√©es.

Les valeurs aberrantes sont des valeurs qui diff√®rent significativement des autres observations sur notre jeu de donn√©es. Elles peuvent √™tre soit beaucoup plus grandes ou beaucoup plus petites que les autres observations avec lequelles on travaille. Elle sont particuli√®rement probl√®matiques dans notre cas, car le mod√®le qu'on cherche √† construire est une r√©gression li√©naire. Dans la r√©gression lin√©aire on utilise la m√©thode des moindres carr√©s pour estimer nos coefficients. Les valeurs aberrantes peuvent donc avoir une influence disprportionn√©e sur cette somme de carr√©s en tirant la ligne de r√©gression vers elles, ce qui fausserait les coefficients estim√©s et pourrait nous induire en erreur en concluant qu'un coefficient est significatif lorsqu'il ne l'ai pas, ou qu'il ai non significatif lorsqu'il l'est. Nous devons donc d√©tecter l'existence de ces valeurs aberrantes et trouver un moyen de les traiter pour s'assurer d'estimer les relations entre nos variables sans biais.

La formule qu'on utilise en g√©n√©ral pour d√©tecter la pr√©sence de valeurs aberrantes est la suivante:

**[ùëÑ1‚àí1.5√óùêºùëÑùëÖ,ùëÑ3+1.5√óùêºùëÑùëÖ]** avec Q1 √©tant le premier quartile et Q3 √©tant le troisi√®me quartile.

On peut √©galement d√©tecter la pr√©sence de valeurs aberrantes gr√¢ce au graphique en boite (le box plot), ou les valeurs aberrantes s'affichent g√©n√©ralement distanc√©es du premier et deuxi√®me quartile. On va voir que dans certaines cas extr√™mes, le box plot s'affiche comme √©tant totalement distordu et √ßa nous permet de d√©tecter la pr√©sence de valeurs aberrantes extr√™mes.

Pour notre analyse, on va analyser chacune de nos variables une par une en commen√ßant par la variable endog√®ne du score environnemental.

Ici, pour la valeur qu'on cherche √† estimer du score environnemental, on remarque qu'il n'y a pas de valeurs aberrantes et on affiche ces principales stastiques gr√¢ce √† la commande summary.

```{r}
boxplot(new_eurostoxx$`Environment Pillar Score`)
summary(new_eurostoxx$`Environment Pillar Score`)

```

On va effectuer de m√™me avec toutes les autres variables qu'on va inclure dans notre mod√®le.

### La variable employ√©s

Pour la variable qui repr√©sente le nombre d'employ√©s, on remarque qu'il y a une tr√®s grande pr√©sence de valeurs aberrantes. On a beaucoup de valeurs qui sont r√©parties vers le haut du graphique et le diagramme est compl√®tement d√©form√©.

```{r}
boxplot(new_eurostoxx$`EMPLOYEES`)
summary(new_eurostoxx$`EMPLOYEES`)
```

Maintenant que nous avons identifi√© graphiquement la pr√©sence de valeurs aberrantes sur la colonne qui correspond au nombre d'employ√©s, on identifie ces valeurs aberrantes et on les mets dans la variable 'Valeurs_aberrantes_employees'. On calcule √©galement le pourcentage de valeurs aberrantes dans notre colonne. Sur la colonne employ√©s, on a plus de 9% des observations qui sont aberrantes, ce qui est √©norme.

```{r}
# Calculer les quartiles et la diff√©rence entre les quartiles
Q1 <- quantile(new_eurostoxx$EMPLOYEES, 0.25, na.rm = TRUE)
Q3 <- quantile(new_eurostoxx$EMPLOYEES, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# D√©finir les limites inf√©rieures et sup√©rieures
limite_inf√©rieure <- Q1 - 1.5 * IQR
limite_sup√©rieure <- Q3 + 1.5 * IQR

# Identifier les valeurs aberrantes
Valeurs_aberrantes_employees <- new_eurostoxx$EMPLOYEES[new_eurostoxx$EMPLOYEES < limite_inf√©rieure | new_eurostoxx$EMPLOYEES > limite_sup√©rieure]
print(Valeurs_aberrantes_employees)

print(length(Valeurs_aberrantes_employees)/length(new_eurostoxx$EMPLOYEES))
#Pr√®s de 10% des valeurs dans la colonnes employees sont des valeurs aberrantes
```

### Variable Operating Profit margin

On fait la m√™me chose avec la variable Operating Profit Margin et on a √©galement un box plot qui s'affiche totalement d√©form√© ce qui indique qui forte pr√©sence de valeurs aberrantes.

```{r}
boxplot(new_eurostoxx$`OPERATING PROFIT MARGIN`)
summary(new_eurostoxx$`OPERATING PROFIT MARGIN`)
```

On fait la m√™me chose qu'on a fait pour employees en cr√©ant un vecteur pour les valeurs aberrantes de 'Operating profit margin'.

```{r}
# Calculer les quartiles et la diff√©rence entre les quartiles
Q1 <- quantile(new_eurostoxx$`OPERATING PROFIT MARGIN`, 0.25, na.rm = TRUE)
Q3 <- quantile(new_eurostoxx$`OPERATING PROFIT MARGIN`, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# D√©finir les limites inf√©rieures et sup√©rieures
limite_inf√©rieure <- Q1 - 1.5 * IQR
limite_sup√©rieure <- Q3 + 1.5 * IQR

# Identifier les valeurs aberrantes
Valeurs_aberrantes_OPM <- new_eurostoxx$`OPERATING PROFIT MARGIN`[new_eurostoxx$`OPERATING PROFIT MARGIN` < limite_inf√©rieure| new_eurostoxx$`OPERATING PROFIT MARGIN` > limite_sup√©rieure]
print(Valeurs_aberrantes_OPM)
print(length(Valeurs_aberrantes_OPM)/length(new_eurostoxx$`OPERATING PROFIT MARGIN`))
#On constate que 7% des valeurs sur la colonnes operating profit margin sont des valeurs aberrantes 
```

### Net Sales or Revenues

On constate √©galement que pour les colonnes net sales or revenues on a beaucoup de valeurs qui semblent extr√™mes.

```{r}
boxplot(new_eurostoxx$`NET SALES OR REVENUES`)
summary(new_eurostoxx$`NET SALES OR REVENUES`)
```

Plus de 11% des observations sur la colonne operating profit margin sont des valeurs aberrantes.

```{r}
# Calculer les quartiles et la diff√©rence entre les quartiles
Q1 <- quantile(new_eurostoxx$`NET SALES OR REVENUES`, 0.25, na.rm = TRUE)
Q3 <- quantile(new_eurostoxx$`NET SALES OR REVENUES`, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# D√©finir les limites inf√©rieures et sup√©rieures
limite_inf√©rieure <- Q1 - 1.5 * IQR
limite_sup√©rieure <- Q3 + 1.5 * IQR

# Identifier les valeurs aberrantes
Valeurs_aberrantes_NetSalesRevenues <- new_eurostoxx$`NET SALES OR REVENUES`[new_eurostoxx$`NET SALES OR REVENUES` < limite_inf√©rieure| new_eurostoxx$`NET SALES OR REVENUES` > limite_sup√©rieure]
print(Valeurs_aberrantes_NetSalesRevenues)
print(length(Valeurs_aberrantes_NetSalesRevenues)/length(new_eurostoxx$`NET SALES OR REVENUES`))
#On constate que 11% des valeurs sur la colonnes operating profit margin sont des valeurs aberrantes
```

### Market Cap

On constate √©galement que pour la colonne Market Cap elle aussi semble avoir plusieurs valeurs extr√™mes.

```{r}
boxplot(new_eurostoxx$`Market Cap`)
summary(new_eurostoxx$`Market Cap`)
```

Plus de 11% des observations sur la colonne market cap sont des valeurs extr√™mes.

```{r}
# Calculer les quartiles et la diff√©rence entre les quartiles
Q1 <- quantile(new_eurostoxx$`Market Cap`, 0.25, na.rm = TRUE)
Q3 <- quantile(new_eurostoxx$`Market Cap`, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# D√©finir les limites inf√©rieures et sup√©rieures
limite_inf√©rieure <- Q1 - 1.5 * IQR
limite_sup√©rieure <- Q3 + 1.5 * IQR

# Identifier les valeurs aberrantes
Valeurs_aberrantes_MarketCap <- new_eurostoxx$`Market Cap`[new_eurostoxx$`Market Cap`< limite_inf√©rieure| new_eurostoxx$`Market Cap` > limite_sup√©rieure]
print(Valeurs_aberrantes_MarketCap)
print(length(Valeurs_aberrantes_MarketCap)/length(new_eurostoxx$`Market Cap`))
#On constate que 12% des valeurs sur la colonne Market Cap sont des valeurs aberrantes
```

### Value - Board Structure/Independent Board Members

Contrairement aux autres colonnes, la colonne value-board structure/independent board members ne semble pas avoir beaucoup de valeurs aberrantes. Sur le graphique on d√©tecte uniquement la pr√©sence de potentiellement 2 valeurs qui sont aberrantes.

```{r}
boxplot(new_eurostoxx$`Value - Board Structure/Independent Board Members`)
summary(new_eurostoxx$`Value - Board Structure/Independent Board Members`)
```

```{r}
# Calculer les quartiles et la diff√©rence entre les quartiles
Q1 <- quantile(new_eurostoxx$`Value - Board Structure/Independent Board Members`, 0.25, na.rm = TRUE)
Q3 <- quantile(new_eurostoxx$`Value - Board Structure/Independent Board Members`, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# D√©finir les limites inf√©rieures et sup√©rieures
limite_inf√©rieure <- Q1 - 1.5 * IQR
limite_sup√©rieure <- Q3 + 1.5 * IQR

# Identifier les valeurs aberrantes
Valeurs_aberrantes_value <- new_eurostoxx$`Value - Board Structure/Independent Board Members`[new_eurostoxx$`Value - Board Structure/Independent Board Members`< limite_inf√©rieure| new_eurostoxx$`Value - Board Structure/Independent Board Members` > limite_sup√©rieure]
print(Valeurs_aberrantes_value)
print(length(Valeurs_aberrantes_value)/length(new_eurostoxx$`Value - Board Structure/Independent Board Members`))
#On constate que 3% des valeurs sur la colonne board structure sont aberrantes 
```

Maintenant qu'on a fait une analyse des valeurs aberrantes, on peut en tirer que sur notre jeu de donn√©es, il y a une pr√©sence de plusieurs valeurs extr√™mes qui peuvent par la suite impacter nos coefficients, voire m√™me les biaiser. Pour cette raison, et afin de garantir les r√©sulats les moins biais√©s possible pour notre r√©gression, on va tra√Æter nos valeurs extr√™mes. Pour cela, de nombreux choix s'offent √† nous, et on va tenter de rapidement les expliquer et puis de justifier l'utilisation d'une de ces m√©thodes pour tra√Æter nos valeurs aberrantes:

-   **Supprimer les valeurs aberrantes:** Une option qui s'offre √† nous et celle de supprimer les valeurs aberrantes. Cela peut √™tre tr√®s tentant car de la sorte on se retrouve avec uniquement des valeurs 'normales'. Cependant, et comme on l'a constat√©, pour certaines colonnes on a plus de 12% de notre jeu de donn√©es qui repr√©sente des valeurs aberrantes, et cela voudra dire supprimer plus de 12% de nos donn√©es. A priori, la raison pour laquelle les valeurs semblent √™tre aussi √©lev√©es ou aussi peu √©lev√©es pour certaines colonne peut relever du fait que notre jeu de donn√©es inclut de tr√®s grandes entreprises et d'autres qui sont moins 'grandes', ce qui peut expliquer de grandes diff√©rences par rapport au nombre d'employ√©s, de profit g√©n√©r√©, de ventes r√©alis√©es, etc. Pour nous, et dans notre cas, on juge que supprimer des valeurs pourrait conduire √† un plus gros biais dans notre regression que de simplement les laisser.

-   **Remplacer par la m√©diane:** Remplacer les valeurs aberrantes par la m√©diane est √©galement une m√©thode tr√®s utilis√©e pour tra√Æter les valeurs aberrantes. Elle peut √™tre valable sous plusieurs sc√©narios et permet de ne pas perdre d'informations. Cependant, cette m√©thode a beaucoup plusieurs de sens lorsque les valeurs aberrantes sont le r√©sultats de fautes de frappes ou de mesure et donc remplace une information qui √©tait 'fausse' par une tendence centrale de la distribution de la colonne concern√©e. Cependant, dans notre cas, et suite √† notre analyse, il ne semblerait pas que les valeurs aberrantes soient le r√©sulat d'informations incorrectes, mais √ßa semblerait plut√¥t √™tre expliqu√© par la pr√©sence de g√©antes, grandes, moyennes, et plus petites entreprises. Pour cela, remplacer par la m√©diane ici nous ferait perdre des informations sur ces observations qu'on a jug√© √™tre 'aberrantes'.

-   **Windsorisation:** La windorisation est une m√©thode qui consiste √† remplacer les valeurs aberrantes par des valeurs qui sont proches, comme un quantile, et permet donc de significativement r√©duire l'impact des valeurs aberrantes. Elle permet donc de ramener les valeurs extr√™mes √† un seuil plus raisonnable. Dans notre cas, elle est jug√©e comme √©tant moins agressive que la supression des donn√©es ou le remplacement par la m√©diane car elle permet de ne pas ignorer la contribution des valeurs extr√™mes, qui dans notre cas, eux aussi ont √©galement des informations qui peuvent √™tre importantes √† consid√©rer pour notre mod√®le. A noter que cette m√©thode ne supprime pas totalement les valeurs aberrantes, mais les ram√®ne √† un seuil raisonnable.

On va appliquer une windsorisation sur toutes les colonnes ou on a identifi√© la pr√©sence de valeurs aberrantes dans notre jeu de donn√©es:

```{r}

library(DescTools) #package qui inclut la fonctiton windsorisation

# Exclure "Environment Pillar Score" de la Winsorisation puisque celle-ci n'avait pas de valeurs aberrantes
eurostoxx_windsorize <- data.frame(lapply(names(new_eurostoxx), function(col_name) {
  col <- new_eurostoxx[[col_name]]  # Extraire la colonne
  if (is.numeric(col) && col_name != "Environment Pillar Score") {
    Winsorize(col, val = quantile(col, probs = c(0.1, 0.9), na.rm = TRUE))
  } else {
    col  # Garder les colonnes non num√©riques ou sp√©cifiquement exclues inchang√©es
  }
}))

# Renommer les colonnes pour correspondre aux noms d'origine
colnames(eurostoxx_windsorize) <- colnames(new_eurostoxx)

# Afficher les donn√©es apr√®s Winsorisation
print(eurostoxx_windsorize)


```

A travers les digrammes en moustache suivants qu'on a produit tout √† l'heure avant d'avoir fait notre traitement des valeurs aberrantes, on observe cependant une grande diff√©rence avec ces digrammes en moustaches qu'on a produit apr√®s la windorisation. Certes il reste encore des valeurs aberrrantes, mais ceci s'explique par le fait que nous sommes en pr√©sence de beaucoup de valeurs aberrantes qui sont utiles dans notre analyse et il serait donc irr√©aliste de ne plus en avoir du tout. Elles ont certes √©t√© r√©duites, mais elle sont encore pr√©sentes dans notre jeu de donn√©e mais de fa√ßon moins extr√™me, ce qui faussera moins les coefficients dans notre regression.

```{r}
colonnes <- c("EMPLOYEES", "OPERATING PROFIT MARGIN", 
                     "NET SALES OR REVENUES", "Market Cap", "ROIC")

# Boucle pour tracer un boxplot pour chaque colonne
for (col in colonnes) {
  boxplot(eurostoxx_windsorize[[col]], 
  main = paste("Boxplot de", col), 
          ylab = col, 
          col = "lightblue")
}

```

### C. Relations entre les variables (question 3)

On commence tout d'abord √† effectuer quelques analyses graphiques en prenant soin √† diff√©rencier entre nos variables qualitative et nos variables quantitatives. Le but de cette analyse est de mieux comprendre notre jeu de donn√©es et d'analyser les diff√©rentes relations qui existent entre nos variables afin de mieux saisir l'effet des diff√©rentes variables sur le environment pillar score qu'on cherche √† expliquer.

```{r}
pander(summary(eurostoxx_windsorize))
```

Sur ce graphique on observe la distribution de la variable qu'on cherche √† expliquer par pays. Ceci peut √™tre int√©ressant pour comprendre et voir si un pays ou un groupe de pays a tendence √† avoir un score environnemental plus ou moins √©lev√© que d'autres.

Une chose que l'on remarque d'embl√©e sur le graphique est que tous les pays ne sont pas tous repr√©sent√©s √©quitablement. C'est √† dire que certains pays sont beaucoup plus pr√©sents que d'autres et on plusieurs observations, tandis que certains pays sont repr√©sent√©s par une ou un nombre petits d'observations.

On observe que des pays comme le Portugal et l'Espagne qui n'ont pas un grand nombre d'observations semblent avoir en moyenne les scores les plus √©lev√©s. Ceci peut √™tre expliqu√© par un biais d'autoselection ou seules les entreprises qui ont un score √©lev√© sont repr√©sent√©e.

```{r}
library('ggplot2')
ggplot(eurostoxx_windsorize, aes(x = `COUNTRY OF DOMICIL`, y = `Environment Pillar Score`)) +
  geom_boxplot() +
  labs(title = "Distribution du Score par Cat√©gorie",
       x = "Cat√©gorie",
       y = "Score Environment Pillar") +
  theme_minimal() +
  #On ajoute cette ligne pour avoir le nom des pays affich√©s de fa√ßon claire avec une rotation de 45¬∞
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Ce graphique repr√©sente la corr√©lation entre les diff√©rents variables quantitatives. La ligne qui nous int√©resse le plus est celle qui repr√©sente 'environment pillar score' sur laquelle il semblerait que la majorit√© des variables aient une corr√©lation positive ou n√©gative avec le score environnemental. Ceci nous indique que nous sommes sur la bonne piste pour plus tard construire notre mod√®le et comprendre si il s'agit de simples corr√©lations (comme repr√©sent√©es ici) ou alors si il y a bel et bien un effet de causalit√© entre nos variables explicatives et la variable du score environnemental.

```{r}
#Package pour la visualisation
library(GGally)
ggpairs(eurostoxx_windsorize, columns = c("Environment Pillar Score", "EMPLOYEES","OPERATING PROFIT MARGIN", "NET SALES OR REVENUES","Market Cap","ROIC", "Value - Board Structure/Independent Board Members"))
```

Le graphique ci-dessous est une autre fa√ßon de visualiser la corr√©lation entre les diff√©rentes variables. On observe quelques corr√©lations entre nos variables explicatives comme 'employees' et 'net sales & revenues', ce qui est assez logique. Plus une entreprise sera grande, plus elle aura d'employ√©s et aura tendence √† r√©aliser un plus grand nombre de ventes et de revenues. On insistera cependant tout √† l'heure sur notre mod√®le √† v√©rifier comme nous ne sommes pas en pr√©sence de multicollin√©arit√©. Le m√™me ph√©nom√®ne est observ√© pour 'market capitalization' et 'net sales & revenues'.

```{r}
library(corrplot)
library(dplyr)

# S√©lectionner uniquement les colonnes num√©riques
numerique_eurostoxx <- new_eurostoxx %>% select_if(is.numeric)

# Calculer la matrice de corr√©lation
correlation_matrix <- cor(numerique_eurostoxx, use = "complete.obs")


# Afficher la heatmap
corrplot(correlation_matrix, method = "color", type = "upper", tl.col = "black", tl.srt = 45, tl.cex = 0.7)

```

Il semblerait qu'il y ait une relation positive entre le nombre d'employ√©s et le score environnemental. Plus le nombre d'employ√©s est grand, plus le score environnemental a tendence √† augmenter. Ceci est assez logique puisque g√©n√©ralement, plus une entreprise est grande, le plus grand budget elle aura √† consacrer plus am√©liorer son impact environnemental. (mais ceci n'est pas toujours vrai!).

```{r}
plot(eurostoxx_windsorize$EMPLOYEES, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect of Employees on Environment Pillar Score",
     xlab = "Employees",
     ylab = "Environment Pillar Score",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$EMPLOYEES), col = "red", lwd = 2)

```

Il ne semble pas y avoir de relation lin√©aire entre la variable operating profit margin et la variable environement pillar score. Le profit ne jouerait √† priori donc pas de r√¥le important sur le score environnemental d'une entreprise, contrairement au nombre d'employ√©s.

```{r}
plot(eurostoxx_windsorize$`OPERATING PROFIT MARGIN`, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect du Profit sur le Score environnemental",
     xlab = "profit",
     ylab = "score environnemental",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$`OPERATING PROFIT MARGIN`), col = "red", lwd = 2)
```

Il semblerait cependant qu'il y ait une relation positive entre le revenu et le score environnemental. On remarque sur ce graphique que plus le revenue d'une entreprise augmente, plus le score environnemental aura √©galement tendence √† augmenter.

```{r}
plot(eurostoxx_windsorize$`NET SALES OR REVENUES`, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect du Revenue sur le Score environnemental",
     xlab = "revenues",
     ylab = "score environnemental",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$`NET SALES OR REVENUES`), col = "red", lwd = 2)
```

Il ne semble cependant pas y avoir une relation entre la capitalization boursi√®re et le score environnemental. On voit une l√©g√®re relation positive, mais reste √† voir si celle-ci sera significative dans notre mod√®le.

```{r}
plot(eurostoxx_windsorize$`Market Cap`, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect de la capitalization du march√© sur le Score environnemental",
     xlab = "Capitalization du march√©",
     ylab = "score environnemental",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$`Market Cap`), col = "red", lwd = 2)
```

Il ne semble pas y avoir une forte relation li√©naire entre le retour sur capital investi et le score environnemental. On observe une l√©g√®re tendence vers la baisse entre les deux variable qui indiquerait que plus le retour sur capital augmenterait, plus le score environnemental baisserait, mais cette relation devra √©galement √™tre v√©rifi√©e par notre mod√®le.

```{r}
plot(eurostoxx_windsorize$ROIC, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect du ROIC sur le Score environnemental",
     xlab = "ROIC",
     ylab = "score environnemental",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$ROIC))
```

Il semblerait qu'il n'y ait pas de relation entre les membres ind√©pendants et le score environnemental.

```{r}
plot(eurostoxx_windsorize$`Value - Board Structure/Independent Board Members`, eurostoxx_windsorize$`Environment Pillar Score`,
     main = "Effect du pourcentage de membres ind√©pendants sur le Score environnemental",
     xlab = "Value",
     ylab = "score environnemental",
     col = "blue", pch = 19)
abline(lm(eurostoxx_windsorize$`Environment Pillar Score` ~ eurostoxx_windsorize$`Value - Board Structure/Independent Board Members`), col = "red", lwd = 2)
```

# PARTIE 4: Mod√©lisation (question 4)

Dans cette partie on va construire notre mod√®le de r√©gression lin√©aire pour voir la relation entre nos variables explicatives et la variable du score environnemental et on va tenter d'interpr√©ter les r√©sultats obtenus.

### Construction d'un premier mod√®le

La premi√®re chose qu'on regarde dans le sommaire de notre mod√®le est la F-Stastistic globale. On voit que notre mod√®le est globalement significatif avec une valeur P qui est largement inf√©rieure √† 5%. Cela signifie qu‚Äôau moins une variable dans le mod√®le explique significativement (est sup√©rieure √† 0) la variation du score environnemental.

La deuxi√®me chose qu'on observe est le coefficient de d√©termination ajust√© (Adjusted R squared). Puisque nous sommes en pr√©sence d'une r√©gression multiple, on ne se contente pas d'observer le coefficient de d√©termination (le R squared) puisque celui-ci augmente artificiellement lorsqu'on ajoute des variables dans un mod√®le, m√™me si elles ne sont pas significatives. On voit donc √† travers le coefficient de d√©termination ajust√© que notre mod√®le explique plus de 37% de la variabilit√© du score environnemental.

En regardant les coefficients, on voit que le nombre d'employ√©s, le profit op√©rationnel, les revenus commerciaux nets, le rendement du capital investi, et la non-mise en place d‚Äôun comit√© de soutenabilit√© CSR contrairement √† la mise en place sont significatifs et permettent d'expliquer de fa√ßon positive ou n√©gative la variabilit√© dans le score environnemental.

Les variables comme la capitalisation boursi√®re de l'entreprise et le pourcentage de membre ind√©pendants dans le bureau ne sont pas significatives et donc ne permettent pas d'expliquer la variabilit√© dans le score environnemental. Les interpr√©ter ne servirait √† rien car elles sont jug√©es comme √©tant indiff√©rentes de 0.

Pour les pays, R a automatiquement pris comme cat√©gorie de r√©f√©rence l'Allemagne et donc les coefficients que l'on voit pour les autres pays sont les diff√©rences par rapport √† celui de l'Allemagne. On voit par exemple que, la France a un coefficient positif et significatif qui signifie que lorsqu'une entreprise est fran√ßaise, elle a tendence a avoir un impact plus √©lev√© de 0.01 unit√©s sur le score environnemental par rapport √† une entreprise allemande. Tous les coefficients pour les pays sont toujours √† interpr√©ter par rapport √† la cat√©gorie de r√©f√©rence qui est l'Allemagne.

La variable employ√©es qui mesure le nombre d'employ√©s dans une entreprise semble √™tre significative √† hauteur de 1%, ce qui d√©passe le seuil de 5%. Il semblerait que plus une entreprise a d'employ√©s, plus son score environnemental aurait tendance √† augmenter. Pour une augmentation d'une unit√© d'employ√©s, il y'aurait une augmentation de 0.00006950 unit√©s dans le score environnemental des entreprises.

La variable opearting profit margin repr√©sente le profit op√©rationnel de l'entreprise, et semble √™tre elle aussi significative √† un seuil de 1%, qui √©galement d√©passe les 5%. Pour une augmentation d'une unit√© dans le profit op√©rationnel de l'entreprise, il y aurait une augmentation de 0.1813 unit√©s dans le score environnemental.

La variable net sales and revenues repr√©sente les revenus commerciaux nets et est aussi fortement significative dans le mod√®le et aurait un impact positif sur le score environnemental d'une entreprise. Plus les revenus commerciaux nets sont √©lev√©s, plus le score environnemental aura tendence √©galement √† √™tre plus haut que la moyenne. Ici, quitte √† une augmentation d'une unit√© dans les revenus commerciaux nets d'une entreprise, il y aurait une augmentation de 0.0000002604 unit√©s dans le score environnemental.

La variable ROIC repr√©sente le rendement du capital investi. Elle est significative dans notre mod√®le √† hauteur de 5%, mais a un impact n√©gatif sur le score environnemental. Plus le rendement du capital investi augmente, plus le score environnemental aura donc tendance √† baisser. Ici, suite √† une augmentation d'une unit√© dans le rendement du capital investi, le score environnemental baisserait de 0.3511 unit√©s.

La variable CSR sustainability committee r√©pr√©sente la mise en place d‚Äôun comit√© de soutenabilit√© CSR. Il s'agit d'une variable cat√©gorique et donc R a pris comme cat√©gorie de r√©f√©rence la cat√©gorie 'Oui'. Le coefficient qui s'affiche ici repr√©sente donc la diff√©rence de variation dans le score environnemental pour la cat√©gorie 'Non' par rapport √† la categorie de r√©f√©rence 'Oui'. Le coefficient est √©galement significatif et donc on observe que lorsqu'une entreprise ne met pas en place un comit√© de soutenabilit√© CSR, son score environnemental aura tendence √† √™tre plus faible qu'une entreprise qui met en place un comit√© de soutenabilit√© CSR. Cette diff√©rence est de -19.17, ce qui est √©norme √©tant donn√© que le score environnemental est un nombre entre 0 et 100. La variable comit√© de soutenabilit√© CSR influencerait donc le score environnemental √† pratiquement hauteur de 20%. Ceci dit, ce r√©sultat est assez logique puisque la mise en place s'un syst√®me CSR au sein des entreprises repr√©sente une des premi√®res √©tapes dans la prise de conscience √©cologique des entreprises de nos jours.

```{r}
#On cr√©e notre mod√®le avec environment pillar score comme variable endog√®ne et le reste comme variables exog√®nes

predictors <- eurostoxx_windsorize[, -ncol(eurostoxx_windsorize)] 
model1 <- lm(`Environment Pillar Score`~ ., data=predictors) #A modifier pour enlever la derni√®re colonne
#commande pour avoir le sommaire du mod√®le
print(summary(model1))
```

On cr√©e un deuxi√®me mod√®le o√π on ne garde que les variables explicatives. On voit que notre mod√®le est globalement significatif, mais cependant le coefficient de d√©termination ajust√© est plus faible sur ce dexi√®me mod√®le que sur le premier. Le premier mod√®le semble donc √™tre plus judicieux et on gardera les interpr√©tations qu'on a effectu√© sur le premier mod√®le.

```{r}
model2 <- lm(`Environment Pillar Score`~ `COUNTRY OF DOMICIL` + EMPLOYEES  + `OPERATING PROFIT MARGIN`+ `NET SALES OR REVENUES`+ ROIC + `CSR Sustainability Committee`, data=new_eurostoxx)
print(summary(model2))
```

Une autre mesure qui permet de comparer les mod√®les entre eux c'est celle de l'AIC (Akaike Information Criterion). On calcule donc l'AIC des deux mod√®les qu'on a construit pour pouvoir les comparer entre eux. En r√®gle g√©n√©ral on choisit le mod√®le avec le AIC le moins √©lev√©, et dans notre cas c'est encore le 1er mod√®le qui semble √™tre plus appropri√© pour expliquer la variable du score environnemental.

```{r}
aic_value1 <- AIC(model1)
aic_value2 <- AIC(model2)

aic_value1 
aic_value2 

```

## R√©gression avec la variable FI

Maintenant, on inclut la variable Fi qui repr√©sente la variabilit√© financi√®re sur le long terme et on essaye de voir l'impact de cette variable sur le score environnemental. En incluant la variabilit√© financi√®re sur le long terme, on constate qu'elle est significative au niveau de 1% dans l'explication sur score environnemental et semble sugg√©rer que le score environnemental d'une entreprise varierait dans le m√™me sens que la variabilit√© financi√®re sur le long terme. Cela pourrait potentiellement s'expliquer par le fait qu‚Äôune forte variabilit√© financi√®re peut pousser une entreprise √† adopter des pratiques durables pour se stabiliser, am√©liorer son image et r√©pondre aux attentes sociales et r√©glementaires.

```{r}
model3 <- lm(`Environment Pillar Score`~ ., data=eurostoxx_windsorize)
#commande pour avoir le sommaire du mod√®le
print(summary(model3))

```

# Conclusion

ans le travail que nous avons pr√©sent√© on a tent√© de r√©pondre aux questions pos√©es tout en allant plus loin dans notre analyse pour saisir l'effet des variables √©conomiques, commerciales, financi√®res, et de gouvernance sur notre variable environnemental.

Nous avons tout d'abord bien expliqu√© le choix de la variable environemental score par rapport √† celle de carbon intensity pour effectuer notre analyse. Il s'est av√©r√© que la variable carbon intensity √©tait manquante dans notre jeu de donn√©es et qu'il n'√©tait donc pas possible d'obtenir des informations sur les √©missions de carbone des entreprises.

Par la suite, nous avons bien pris soin de nettoyer notre jeu de donn√©es en accomplissant les modifications suivantes:

-   Ne conserver que les colonnes dont on a besoin pour l'analyse et les renommer

-   Faire en sorte que R reconnaisse les valeurs manquantes (NA)

-   Faire en sorte en R diff√©rencie entre les variables num√©riques et cat√©goriques

-   Analyser et traiter les valeurs manquantes en les supprimant ou en les rempla√ßant par la m√©diane

-   Analyser et traiter les valeurs aberrantes par m√©thode de windsorisation

On a utilis√© la repr√©sentation graphique et les statistiques descriptives pour analyser, reconna√Ætre et traiter les probl√®mes qui pouvaient exister sur notre jeu de donn√©es.

Puis on a √©galement utilis√© la repr√©sentation graphique et les statistiques pour analyser les relations entre nos variables avant de passer √† la mod√©lisation.

Une fois nos donn√©es pr√™tes, et apr√®s avoir r√©alis√© une analyse de donn√©es, nous avons pu mod√©liser nos donn√©es √† travers une r√©gression lin√©aire qui nous a permis de bien saisir la relation entre notre variable endog√®ne (score environnemental) et nos variables exog√®nes. On a pu voir que le mod√®le construit √©tait stastiquement significatif et que nos variables ont pu expliquer plus de 34% de la variation dans le score environnemental.

Comme tout travail statistique qui est limit√© par un temps, on doit toujours faire des choix. Tout au long de ce projet, nous avons tent√© d'effectuer les choix qui semblaient √™tre les plus raisonnables, mais bien √©videmment d'autres choix auraient p√ªt √™tre fait et auraient peut-√™tre conclus √† un mod√®le qui explique une plus grande partie de la variation de notre variable d'int√©r√™t. Dans le futur, on peut ajouter d'autres variables, traiter les valeurs manquantes ou aberrantes de fa√ßon diff√©rente. D'autres analyses suite √† la r√©gression peuvent √©galement √™tre faites pour d√©tecter si il y a des probl√®mes de multiculinarit√©, de h√©t√©rosc√©dasticit√© ou d'endogeneit√© dans le mod√®le. D'autres mod√®les de r√©gression comme les GLM peuvent √©galement √™tre mis en place et comparer avec le mod√®le que nous avons construit dans cette analyse.
